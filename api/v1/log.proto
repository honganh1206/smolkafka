syntax = "proto3";

// Used as package name in generated Go code
package log.v1;

option go_package = "github.com/honganh1206/smollkafka/api/log_v1";

message Record {
		bytes value = 1;
		uint64 offset = 2;
        uint64 term  = 3;
        uint32 type = 4;
}

service Log {
	rpc Produce(ProduceRequest) returns (ProduceResponse) {}
	rpc Consume(ConsumeRequest) returns (ConsumeResponse) {}
	rpc ConsumeStream(ConsumeRequest) returns (stream ConsumeResponse) {}
	// Bi-directional.
	// Two streams operate independently, so the clients and servers can read and write in whatever order they like.
	// Example: The server could wait to receive all clients' requests before sending back its response (used for batches or agggregating a response over multiple requests)
	rpc ProduceStream(stream ProduceRequest) returns (stream ProduceResponse) {}
    rpc GetServers(GetServersRequest) returns (GetServersResponse) {}
}

message ProduceRequest {
	Record record = 1;
}

message ProduceResponse {
	uint64 offset = 1;
}

message ConsumeRequest {
	uint64 offset = 1;
}

message ConsumeResponse {
	Record record = 2;
}

message GetServersRequest {}

message GetServersResponse {
  repeated Server servers = 1;
}

message Server {
  string id = 1;
  string rpc_addr = 2;
  bool is_leader = 3;
}
